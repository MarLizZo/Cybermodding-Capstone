<div class="h-100 pb-5">
    <app-hero></app-hero>
    <div *ngIf="!isLoadingPage && !granted" class="container-fluid d-flex flex-column align-items-center mt-5">
        <h2>Non sei autorizzato..</h2>
        <h2>Ti rispedisco alla Home..</h2>
    </div>
    <div *ngIf="!isLoadingPage && granted" class="container-fluid mt-4">
        <h1 class="mb-2 text-danger">{{ username }}</h1>
        <h3 class="mb-4">Pannello Admin</h3>

        <div class="head-container d-flex flex-column flex-lg-row align-items-center justify-content-lg-evenly p-3">
            <button #userMod class="btn moderation-btn px-4 rounded-1 btn-selected border-0"
                (click)="switchModeration(0)">Moderazione utenti</button>
            <button #threadMod class="btn moderation-btn px-4 rounded-1 border-0 mt-2 mt-lg-0"
                (click)="switchModeration(1)">Moderazione threads</button>
            <button #sectionMod class="btn moderation-btn px-4 rounded-1 border-0 mt-2 mt-lg-0"
                (click)="switchModeration(2)">Moderazione sezioni</button>
            <button #blockMod class="btn moderation-btn px-4 rounded-1 border-0 mt-2 mt-lg-0"
                (click)="switchModeration(3)">Moderazione blocchi</button>
        </div>

        <div class="main-container p-3">
            <div *ngIf="isUsersModeration" class="moderation-body d-flex flex-column align-items-center mt-2">
                <p id="top-user" class="mb-2">Cerca utenti</p>
                <form (submit)="searchUsers(0)" class="w-100 d-flex justify-content-center">
                    <input [(ngModel)]="inputSearchUser" name="inputSearchUser" type="text"
                        class="form-control form-control-sm px-2 border-0 shadow-none resp-input"
                        placeholder="Cerca utente..">
                </form>
                <p *ngIf="usersFound == undefined" class="mt-4 fw-medium fs-5">Il risultato apparirà qui</p>

                <div *ngIf="usersFound != undefined && usersFound.content.length != 0" class="w-100 mt-4 p-3">
                    <div *ngFor="let u of usersFound.content; let i = index; let first = first" class="single-result"
                        [ngClass]="{'mt-3' : !first}">
                        <div class="su-head d-flex justify-content-between align-items-center py-2 px-3 rounded-1">
                            <p class="m-0 fw-medium fs-5" [innerText]="userNamesArr[i]"
                                [ngClass]="{'text-mod' : u.roles![0].id == 2, 'text-danger' : u.roles![0].id == 3, 'text-decoration-line-through' : u.roles![0].id == 4}">
                            </p>
                            <i class="bi bi-arrow-bar-down" (click)="collapseableArr[i] = !collapseableArr[i]"></i>
                        </div>

                        <div #collapse="ngbCollapse" [(ngbCollapse)]="collapseableArr[i]"
                            class="options-container p-3 pb-4">
                            <form #f="ngForm" class="d-flex flex-column align-items-center">
                                <div class="resp-div">
                                    <label [htmlFor]="'uid-' + i" class="mb-1 align-self-start">ID Utente</label>
                                    <input [id]="'uid-' + i" type="text" ngModel name="uid"
                                        class="form-control form-control-sm px-1 border-0 shadow-none disabled"
                                        [(ngModel)]="u.id" disabled>
                                </div>

                                <div class="resp-div mt-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <label [htmlFor]="'username-' + i">Username</label>
                                        <p [id]="'err-us-' + i" class="m-0 text-danger d-none"></p>
                                    </div>
                                    <input [id]="'username-' + i" type="text" ngModel name="username"
                                        class="form-control form-control-sm px-1 border-0 shadow-none"
                                        [(ngModel)]="u.username" minlength="3" maxlength="30">
                                </div>

                                <div class="resp-div mt-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <label [htmlFor]="'email-' + i">Email</label>
                                        <p [id]="'err-em-' + i" class="m-0 text-danger d-none">Invalida</p>
                                    </div>
                                    <input ngModel name="email" [id]="'email-' + i" type="email"
                                        class="form-control form-control-sm px-1 border-0 shadow-none"
                                        [(ngModel)]="u.email">
                                </div>

                                <div class="resp-div mt-3">
                                    <div class="d-flex justify-content-between mb-1">
                                        <label [htmlFor]="'descr-' + i">Description</label>
                                        <p [id]="'err-de-' + i" class="m-0 text-danger d-none">Max 20 chars</p>
                                    </div>
                                    <input [id]="'descr-' + i" type="text" ngModel name="description"
                                        class="form-control form-control-sm px-1 border-0 shadow-none"
                                        [(ngModel)]="u.description" maxlength="25">
                                </div>

                                <div class="resp-div mt-3 mb-4">
                                    <div class="d-flex justify-content-between mb-1">
                                        <label [htmlFor]="'role-' + i">Ruolo</label>
                                        <p [id]="'err-ru-' + i" class="m-0 text-danger d-none">Non consentito</p>
                                    </div>
                                    <select name="role" [id]="'role-' + i" [(ngModel)]="u.roles![0].id"
                                        class="form-select form-select-sm border-0 shadow-none">
                                        <option value="1">User</option>
                                        <option value="2">Moderator</option>
                                        <option value="3">Admin</option>
                                        <option value="4">Bannato</option>
                                    </select>
                                </div>
                                <app-orange-button *ngIf="u.roles![0].id != 3" [btnTheme]="'orange'"
                                    [btnTitle]="'Modera utente'" (click)="doUserModerate(f, i)"
                                    [ngClass]="{'disabled' : u.roles![0].id == 3}"></app-orange-button>
                                <div class="mt-3">
                                    <app-inline-loader *ngIf="isOpUsers"></app-inline-loader>
                                </div>
                                <p [id]="'userParagMod' + i" class="mt-3 mb-0 fs-5 fw-medium opacity-0">Utente moderato
                                    con
                                    successo!
                                </p>
                            </form>
                        </div>
                    </div>
                    <div class="row w-100 pageable-container py-2 px-3 mt-5 d-flex align-items-center">
                        <div class="col-12 col-md-3 mb-2 mb-md-0 px-0 px-md-2">
                            <div class="previous rounded-1 px-2 d-flex" *ngIf="!usersFound.first"
                                (click)="searchUsers(usersFound.number - 1)">
                                <i class="bi bi-arrow-bar-left"></i>
                                <p class="m-0 ms-2">Indietro</p>
                            </div>
                        </div>
                        <div class="col-12 col-md-6 d-flex justify-content-center">
                            <div class="pages d-flex justify-content-center flex-wrap rounded-1">
                                <div *ngFor="let p of userPagesArr; let first = first;"
                                    [ngClass]="{'ms-3' : !first, 'actual-page' : p - 1 == usersFound.number}"
                                    class="btn-page px-2" (click)="searchUsers(p - 1)">
                                    <p class="m-0">{{ p }}</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-md-3 d-flex justify-content-end mt-2 mt-md-0 px-0 px-md-2">
                            <div class="next rounded-1 px-2 d-flex" *ngIf="!usersFound.last"
                                (click)="searchUsers(usersFound.number + 1)">
                                <p class="m-0 me-2">Avanti</p>
                                <i class="bi bi-arrow-bar-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="isThreadsModeration" class="moderation-body d-flex flex-column align-items-center mt-2">
                <div
                    class="thread-view w-100 d-flex flex-column flex-lg-row align-items-center justify-content-lg-evenly pb-3">
                    <button #threadViewSearch class="btn moderation-btn btn-sm px-4 rounded-1 border-0 btn-selected"
                        (click)="switchThreadView(0)">Cerca Thread</button>
                    <button #threadViewAll class="btn btn-sm moderation-btn px-4 mt-2 mt-lg-0 rounded-1 border-0"
                        (click)="switchThreadView(1)">Tutti i thread</button>
                </div>

                <div *ngIf="isThreadViewSearch" class="mt-3 w-100 d-flex flex-column align-items-center">
                    <p id="top-user" class="mb-2">Cerca thread in base a</p>
                    <select #selectCriteria name="criteria" [(ngModel)]="threadSearchCriteria"
                        class="form-select form-select-sm border-0 shadow-none mb-3">
                        <option value="0">Titolo</option>
                        <option value="1">Username Autore</option>
                        <option value="2">Data pubblicazione</option>
                    </select>
                    <div *ngIf="threadSearchCriteria == 2"
                        class="d-flex flex-column flex-md-row align-items-center justify-content-md-evenly w-75 mb-3">
                        <div class="mb-3 mb-md-0">
                            <label for="data-1">Data Inizio</label>
                            <input type="date" name="data-1" id="data-1" [(ngModel)]="startDateThread"
                                class="form-control form-control-sm border-0 shadow-none">
                        </div>
                        <div>
                            <label for="data-2">Data Fine</label>
                            <input type="date" name="data-2" id="data-2" [(ngModel)]="endDateThread"
                                class="form-control form-control-sm border-0 shadow-none">
                        </div>
                    </div>
                    <form *ngIf="threadSearchCriteria != 2" (submit)="doThreadSearch(0)"
                        class="w-100 d-flex justify-content-center">
                        <input [(ngModel)]="inputSearchThread" name="inputSearchThread" type="text"
                            class="form-control form-control-sm px-2 border-0 shadow-none resp-input"
                            placeholder="Cerca thread..">
                    </form>
                    <button *ngIf="threadSearchCriteria == 2"
                        class="btn moderation-btn btn-sm px-5 rounded-1 border-0 btn-selected"
                        (click)="doThreadSearch(0)">Cerca thread per Data</button>
                    <p *ngIf="threadsCustomFound == undefined" class="mt-4 fw-medium fs-5">Il risultato apparirà qui</p>

                    <div *ngIf="threadsCustomFound != undefined" class="w-100 p-3 mt-4">
                        <div *ngFor="let t of threadsCustomFound.content; let i = index; let first = first"
                            class="single-result" [ngClass]="{'mt-3' : !first}">
                            <div class="su-head d-flex justify-content-between align-items-center py-2 px-3 rounded-1">
                                <div class="flex-grow-1">
                                    <p class="m-0 fw-medium fs-5 title-trunc">{{ threadTitleCustomArr[i] }}</p>
                                    <p class="m-0">Avviato da: <span
                                            [ngClass]="{'text-danger' : t.user_level!.toString() == 'BOSS', 'text-mod' : t.user_level!.toString() == 'MID'}">
                                            {{ t.author.username }}</span>
                                    </p>
                                </div>
                                <i class="bi bi-arrow-bar-down"
                                    (click)="collapseableTCArr[i] = !collapseableTCArr[i]"></i>
                            </div>
                            <div #collapse="ngbCollapse" [(ngbCollapse)]="collapseableTCArr[i]"
                                class="options-container p-3 pb-4">

                                <form #f="ngForm" class="d-flex flex-column align-items-center">
                                    <div class="resp-div">
                                        <label [htmlFor]="'tidc-' + i" class="mb-1 align-self-start">ID Thread</label>
                                        <input [id]="'tidc-' + i" type="text" ngModel name="tidc"
                                            class="form-control form-control-sm px-1 border-0 shadow-none disabled"
                                            [(ngModel)]="t.id" disabled>
                                    </div>

                                    <div class="resp-div mt-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'titlec-' + i">Titolo</label>
                                            <p [id]="'err-tic-' + i" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <input [id]="'titlec-' + i" type="text" ngModel name="titlec"
                                            class="form-control form-control-sm px-1 border-0 shadow-none"
                                            [(ngModel)]="t.title" maxlength="80">
                                    </div>

                                    <div
                                        class="resp-div mt-3 mb-4 d-flex flex-column flex-md-row align-items-center justify-content-md-center">
                                        <div class="form-check form-check-inline mb-3 mb-md-0">
                                            <input class="form-check-input shadow-none" type="radio"
                                                name="flexRadioDefault" id="flexRadioDefault1" checked>
                                            <label class="form-check-label" for="flexRadioDefault1">
                                                Attivo e visibile
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input shadow-none" type="radio"
                                                name="flexRadioDefault" id="flexRadioDefault2">
                                            <label class="form-check-label" for="flexRadioDefault2">
                                                Disattivo e non visibile
                                            </label>
                                        </div>
                                    </div>

                                    <app-orange-button [btnTheme]="'orange'" [btnTitle]="'Modera Thread'"
                                        (click)="doPostModerate(f, i)"></app-orange-button>
                                    <div *ngIf="isOpThread" class="mt-3">
                                        <app-inline-loader></app-inline-loader>
                                    </div>
                                    <p [id]="'threadParagMod' + i" #threadParagMod
                                        class="mt-3 mb-0 fs-5 fw-medium opacity-0">Thread moderato con
                                        successo!</p>
                                </form>

                            </div>
                        </div>
                        <div class="row w-100 pageable-container py-2 px-3 mt-5 d-flex align-items-center">
                            <div class="col-12 col-md-3 mb-2 mb-md-0 px-0 px-md-2">
                                <div class="previous rounded-1 px-2 d-flex" *ngIf="!threadsCustomFound.first"
                                    (click)="doThreadSearch(threadsCustomFound.number - 1)">
                                    <i class="bi bi-arrow-bar-left"></i>
                                    <p class="m-0 ms-2">Indietro</p>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 d-flex justify-content-center">
                                <div class="pages d-flex justify-content-center flex-wrap rounded-1">
                                    <div *ngFor="let p of threadPagesCustomArr; let first = first;"
                                        [ngClass]="{'ms-3' : !first, 'actual-page' : p - 1 == threadsCustomFound.number}"
                                        class="btn-page px-2" (click)="doThreadSearch(p - 1)">
                                        <p class="m-0">{{ p }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-3 d-flex justify-content-end mt-2 mt-md-0 px-0 px-md-2">
                                <div class="next rounded-1 px-2 d-flex" *ngIf="!threadsCustomFound.last"
                                    (click)="doThreadSearch(threadsCustomFound.number + 1)">
                                    <p class="m-0 me-2">Avanti</p>
                                    <i class="bi bi-arrow-bar-right"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>

                <div *ngIf="isThreadViewAll" class="mt-3 w-100 d-flex flex-column align-items-center">
                    <button *ngIf="threadsFound == undefined"
                        class="btn moderation-btn btn-sm px-4 rounded-1 border-0 btn-selected"
                        (click)="doThreadSearch(0)">Cerca tutti i
                        thread</button>
                    <div *ngIf="threadsFound != undefined" class="w-100">
                        <div *ngFor="let t of threadsFound.content; let i = index; let first = first"
                            class="single-result" [ngClass]="{'mt-3' : !first}">
                            <div class="su-head d-flex justify-content-between align-items-center py-2 px-3 rounded-1">
                                <div class="flex-grow-1">
                                    <p class="m-0 fw-medium fs-5 title-trunc">{{ threadTitleArr[i] }}</p>
                                    <p class="m-0">Avviato da: <span
                                            [ngClass]="{'text-danger' : t.user_level!.toString() == 'BOSS', 'text-mod' : t.user_level!.toString() == 'MID'}">
                                            {{ t.author.username }}</span>
                                    </p>
                                </div>
                                <i class="bi bi-arrow-bar-down"
                                    (click)="collapseableTArr[i] = !collapseableTArr[i]"></i>
                            </div>
                            <div #collapse="ngbCollapse" [(ngbCollapse)]="collapseableTArr[i]"
                                class="options-container p-3 pb-4">

                                <form #f="ngForm" class="d-flex flex-column align-items-center">
                                    <div class="resp-div">
                                        <label [htmlFor]="'tid-' + i" class="mb-1 align-self-start">ID Thread</label>
                                        <input [id]="'tid-' + i" type="text" ngModel name="tid"
                                            class="form-control form-control-sm px-1 border-0 shadow-none disabled"
                                            [(ngModel)]="t.id" disabled>
                                    </div>

                                    <div class="resp-div mt-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'title-' + i">Titolo</label>
                                            <p [id]="'err-ti-' + i" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <input [id]="'title-' + i" type="text" ngModel name="title"
                                            class="form-control form-control-sm px-1 border-0 shadow-none"
                                            [(ngModel)]="t.title" maxlength="80">
                                    </div>

                                    <div class="resp-div mt-3 mb-4 d-flex justify-content-center">
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input shadow-none" type="radio"
                                                name="flexRadioDefault" id="flexRadioDefault1" checked>
                                            <label class="form-check-label" for="flexRadioDefault1">
                                                Attivo e visibile
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input class="form-check-input shadow-none" type="radio"
                                                name="flexRadioDefault" id="flexRadioDefault2">
                                            <label class="form-check-label" for="flexRadioDefault2">
                                                Disattivo e non visibile
                                            </label>
                                        </div>
                                    </div>

                                    <app-orange-button [btnTheme]="'orange'" [btnTitle]="'Modera Thread'"
                                        (click)="doPostModerate(f, i)"></app-orange-button>
                                    <div *ngIf="isOpThread" class="mt-3">
                                        <app-inline-loader></app-inline-loader>
                                    </div>
                                    <p [id]="'threadAllParagMod' + i" #threadAllParagMod
                                        class="mt-3 mb-0 fs-5 fw-medium opacity-0">Thread moderato con
                                        successo!</p>
                                </form>
                            </div>
                        </div>

                        <div class="row w-100 pageable-container py-2 px-3 mt-5 d-flex align-items-center">
                            <div class="col-12 col-md-3 mb-2 mb-md-0 px-0 px-md-2">
                                <div class="previous rounded-1 px-2 d-flex" *ngIf="!threadsFound.first"
                                    (click)="doThreadSearch(threadsFound.number - 1)">
                                    <i class="bi bi-arrow-bar-left"></i>
                                    <p class="m-0 ms-2">Indietro</p>
                                </div>
                            </div>
                            <div class="col-12 col-md-6 d-flex justify-content-center">
                                <div class="pages d-flex justify-content-center flex-wrap rounded-1">
                                    <div *ngFor="let p of threadPagesArr; let first = first;"
                                        [ngClass]="{'ms-3' : !first, 'actual-page' : p - 1 == threadsFound.number}"
                                        class="btn-page px-2" (click)="doThreadSearch(p - 1)">
                                        <p class="m-0">{{ p }}</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-md-3 d-flex justify-content-end mt-2 mt-md-0 px-0 px-md-2">
                                <div class="next rounded-1 px-2 d-flex" *ngIf="!threadsFound.last"
                                    (click)="doThreadSearch(threadsFound.number + 1)">
                                    <p class="m-0 me-2">Avanti</p>
                                    <i class="bi bi-arrow-bar-right"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="isSectionsModeration" class="moderation-body d-flex flex-column align-items-center mt-2">
                <div
                    class="sections-view w-100 d-flex flex-column flex-lg-row align-items-center justify-content-lg-evenly pb-3">
                    <button #sectionViewCreate class="btn moderation-btn btn-sm px-4 rounded-1 border-0 btn-selected"
                        (click)="switchSectionView(0)">Crea nuova sezione</button>
                    <button #subSectionViewCreate class="btn btn-sm moderation-btn px-4 rounded-1 border-0 mt-2 mt-lg-0"
                        (click)="switchSectionView(1)">Crea nuova sotto-sezione</button>
                    <button #sectionViewAll class="btn btn-sm moderation-btn px-4 rounded-1 border-0 mt-2 mt-lg-0"
                        (click)="switchSectionView(2)">Tutte le sezioni</button>
                </div>

                <div *ngIf="isSectionViewCreate" class="w-100 mt-3 d-flex justify-content-center">
                    <form #fNewSection="ngForm" class="w-100 pb-2 d-flex flex-column align-items-center">

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'stitle'">Titolo</label>
                                <p [id]="'err-ti'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'stitle'" type="text" ngModel name="title"
                                class="form-control form-control-sm px-1 border-0 shadow-none" maxlength="60">
                        </div>

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'sdescr'">Descrizione</label>
                                <p [id]="'err-descr'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'sdescr'" type="text" ngModel name="description"
                                class="form-control form-control-sm px-1 border-0 shadow-none" maxlength="100">
                        </div>

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'sorder'">Ordine visualizzazione</label>
                                <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'sorder'" type="number" ngModel name="order"
                                class="form-control form-control-sm px-1 border-0 shadow-none">
                        </div>

                        <div
                            class="resp-div mt-3 mb-4 d-flex flex-column flex-md-row align-items-center justify-content-md-center">
                            <div class="form-check form-check-inline mb-3 mb-md-0">
                                <input #activeRadioOne class="form-check-input shadow-none" type="radio" name="active"
                                    id="flexRadioDefault1" checked>
                                <label class="form-check-label" for="flexRadioDefault1">
                                    Attiva e visibile
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input #activeRadioTwo class="form-check-input shadow-none" type="radio" name="active"
                                    id="flexRadioDefault2">
                                <label class="form-check-label" for="flexRadioDefault2">
                                    Disattiva e non visibile
                                </label>
                            </div>
                        </div>

                        <app-orange-button [btnTheme]="'orange'" [btnTitle]="'Crea Sezione'"
                            (click)="doCreateSection(fNewSection)"></app-orange-button>
                        <div *ngIf="isOpSection" class="mt-3">
                            <app-inline-loader></app-inline-loader>
                        </div>
                        <p #sectionCParagMod class="mt-3 mb-0 fs-5 fw-medium opacity-0">Sezione Creata con
                            successo!</p>
                    </form>
                </div>

                <div *ngIf="isSubSectionViewCreate" class="w-100 mt-3 d-flex justify-content-center">
                    <form #fNewSubSection="ngForm" class="w-100 pb-2 d-flex flex-column align-items-center">

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <p class="m-0">Sezione Genitore</p>
                                <p [id]="'err-parent'" class="m-0 text-danger d-none"></p>
                            </div>
                            <select name="ss-select" [(ngModel)]="newSubSectionParentId"
                                class="form-control form-control-sm border-0 shadow-none">
                                <option value="-1">Seleziona Sezione Genitore</option>
                                <option *ngFor="let s of sectionsArr; let i = index" [value]="s.id">{{ s.title }}
                                </option>
                            </select>
                        </div>

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'stitle'">Titolo</label>
                                <p [id]="'err-ti'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'stitle'" type="text" ngModel name="title"
                                class="form-control form-control-sm px-1 border-0 shadow-none" maxlength="40">
                        </div>

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'sdescr'">Descrizione</label>
                                <p [id]="'err-descr'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'sdescr'" type="text" ngModel name="description"
                                class="form-control form-control-sm px-1 border-0 shadow-none" maxlength="80">
                        </div>

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'sorder'">Ordine visualizzazione</label>
                                <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'sorder'" type="number" ngModel name="order"
                                class="form-control form-control-sm px-1 border-0 shadow-none">
                        </div>

                        <div
                            class="resp-div mt-3 mb-4 d-flex flex-column flex-md-row align-items-center justify-content-md-center">
                            <div class="form-check form-check-inline mb-2 mb-md-0">
                                <input #activeRadioOne class="form-check-input shadow-none" type="radio" name="active"
                                    id="flexRadioDefault1" checked>
                                <label class="form-check-label" for="flexRadioDefault1">
                                    Attiva e visibile
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input #activeRadioTwo class="form-check-input shadow-none" type="radio" name="active"
                                    id="flexRadioDefault2">
                                <label class="form-check-label" for="flexRadioDefault2">
                                    Disattiva e non visibile
                                </label>
                            </div>
                        </div>

                        <app-orange-button [btnTheme]="'orange'" [btnTitle]="'Crea Sotto-Sezione'"
                            (click)="doCreateSubSection(fNewSubSection)"></app-orange-button>
                        <div *ngIf="isOpSection" class="mt-3">
                            <app-inline-loader></app-inline-loader>
                        </div>
                        <p #subsectionCParagMod class="mt-3 mb-0 fs-5 fw-medium opacity-0">Sezione Creata con
                            successo!</p>
                    </form>
                </div>

                <div *ngIf="isSectionViewAll" class="w-100 mt-3">
                    <div *ngIf="sectionsArr.length" class="w-100">
                        <div *ngFor="let s of sectionsArr; let i = index; let first = first" class="single-result"
                            [ngClass]="{'mt-3' : !first}">
                            <div class="su-head d-flex justify-content-between align-items-center py-2 px-3 rounded-1">
                                <div class="flex-grow-1">
                                    <p class="m-0 fw-medium fs-5 title-trunc">{{ sectionsTitleArr[i] }}</p>
                                    <p class="m-0" [innerText]="s.active ? 'Attiva' : 'Disattiva'"
                                        [ngClass]="{'text-danger' : !s.active, 'text-mod' : s.active}"></p>
                                </div>
                                <i class="bi bi-arrow-bar-down" (click)="resetSecCollapse(i)"></i>
                            </div>
                            <div #collapseSections="ngbCollapse" [(ngbCollapse)]="collapseableSArr[i]"
                                class="options-container p-3 pb-4">

                                <form #fSection="ngForm" class="d-flex flex-column align-items-center mb-3">
                                    <div class="resp-div">
                                        <label [htmlFor]="'sid-' + i" class="mb-1 align-self-start">ID Sezione</label>
                                        <input [id]="'sid-' + i" type="text" ngModel name="id"
                                            class="form-control form-control-sm px-1 border-0 shadow-none disabled"
                                            [(ngModel)]="s.id" disabled>
                                    </div>

                                    <div class="resp-div mt-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'stitle-' + i">Titolo</label>
                                            <p [id]="'err-ti-' + i" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <input [id]="'stitle-' + i" type="text" ngModel name="title"
                                            class="form-control form-control-sm px-1 border-0 shadow-none"
                                            [(ngModel)]="s.title" maxlength="60">
                                    </div>

                                    <div class="resp-div mt-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'sdescr-' + i">Descrizione</label>
                                            <p [id]="'err-descr-' + i" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <input [id]="'sdescr-' + i" type="text" ngModel name="description"
                                            class="form-control form-control-sm px-1 border-0 shadow-none"
                                            [(ngModel)]="s.description" maxlength="100">
                                    </div>

                                    <div class="resp-div mt-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'sorder-' + i">Ordine visualizzazione</label>
                                            <p [id]="'err-order-' + i" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <input [id]="'sorder-' + i" type="number" ngModel name="order"
                                            class="form-control form-control-sm px-1 border-0 shadow-none"
                                            [(ngModel)]="s.order_number">
                                    </div>

                                    <div
                                        class="resp-div mt-3 mb-4 d-flex flex-column flex-md-row align-items-center justify-content-md-center">
                                        <div class="form-check form-check-inline mb-2 mb-md-0">
                                            <input #activeRadioOne class="form-check-input shadow-none" type="radio"
                                                (change)="activeBoolArr[i] = !activeBoolArr[i]" name="active"
                                                id="flexRadioDefault1" [checked]="activeBoolArr[i]">
                                            <label class="form-check-label" for="flexRadioDefault1">
                                                Attiva e visibile
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input #activeRadioTwo class="form-check-input shadow-none" type="radio"
                                                (change)="activeBoolArr[i] = !activeBoolArr[i]" name="active"
                                                id="flexRadioDefault2" [checked]="!activeBoolArr[i]">
                                            <label class="form-check-label" for="flexRadioDefault2">
                                                Disattiva e non visibile
                                            </label>
                                        </div>
                                    </div>

                                    <div
                                        class="w-100 d-flex flex-column flex-md-row align-items-center justify-content-md-evenly">
                                        <app-orange-button [btnTheme]="'dark'" [btnTitle]="'Elimina Sezione'"
                                            (click)="deleteSection(s.id!)" class="mb-3 mb-md-0"></app-orange-button>
                                        <app-orange-button [btnTheme]="'orange'" [btnTitle]="'Aggiorna Sezione'"
                                            (click)="doSectionUpdate(i, fSection)"></app-orange-button>
                                    </div>
                                    <div *ngIf="isOpSection" class="mt-3">
                                        <app-inline-loader></app-inline-loader>
                                    </div>
                                    <p [id]="'sectionUParagMod' + i" #sectionUParagMod
                                        class="mt-3 mb-0 fs-5 fw-medium opacity-0">Sezione aggiornata
                                        con
                                        successo!</p>
                                </form>

                                <div class="w-100 mt-5">
                                    <div class="resp-div mx-auto">
                                        <h6 class="mb-2">Sotto-Sezioni</h6>
                                        <select name="ss-select" [(ngModel)]="selectedSSIndex"
                                            class="form-control form-control-sm border-0 shadow-none mb-4">
                                            <option value="-1">Lista sotto-sezioni</option>
                                            <option *ngFor="let ss of s.sub_sections; let ssi = index" [value]="ssi">{{
                                                ss.title
                                                }}
                                            </option>
                                        </select>
                                    </div>

                                    <div *ngIf="selectedSSIndex >= 0 && s.sub_sections && selectedSSIndex < s.sub_sections.length && s.sub_sections[selectedSSIndex].id != undefined"
                                        class="mb-4">
                                        <form #fSS="ngForm" class="w-100 d-flex flex-column align-items-center">
                                            <div class="resp-div">
                                                <label [htmlFor]="'ssid-' + selectedSSIndex"
                                                    class="mb-1 align-self-start">ID
                                                    Sotto-Sezione</label>
                                                <input [id]="'ssid-' + selectedSSIndex" type="text" ngModel name="ssid"
                                                    class="form-control form-control-sm px-1 border-0 shadow-none disabled"
                                                    [(ngModel)]="s.sub_sections![selectedSSIndex].id" disabled>
                                            </div>

                                            <div class="resp-div mt-3">
                                                <div class="d-flex justify-content-between mb-1">
                                                    <label [htmlFor]="'sstitle-' + selectedSSIndex">Titolo</label>
                                                    <p [id]="'err-ssti-' + selectedSSIndex"
                                                        class="m-0 text-danger d-none"></p>
                                                </div>
                                                <input [id]="'sstitle-' + selectedSSIndex" type="text" ngModel
                                                    name="sstitle"
                                                    class="form-control form-control-sm px-1 border-0 shadow-none"
                                                    [(ngModel)]="s.sub_sections![selectedSSIndex].title" maxlength="60">
                                            </div>

                                            <div class="resp-div mt-3">
                                                <div class="d-flex justify-content-between mb-1">
                                                    <label [htmlFor]="'ssdescr-' + selectedSSIndex">Descrizione</label>
                                                    <p [id]="'err-ssdescr-' + selectedSSIndex"
                                                        class="m-0 text-danger d-none"></p>
                                                </div>
                                                <input [id]="'ssdescr-' + selectedSSIndex" type="text" ngModel
                                                    name="ssdescription"
                                                    class="form-control form-control-sm px-1 border-0 shadow-none"
                                                    [(ngModel)]="s.sub_sections![selectedSSIndex].description"
                                                    maxlength="100">
                                            </div>

                                            <div class="resp-div mt-3">
                                                <div class="d-flex justify-content-between mb-1">
                                                    <label [htmlFor]="'ssorder-' + selectedSSIndex">Ordine
                                                        visualizzazione</label>
                                                    <p [id]="'err-ssorder-' + selectedSSIndex"
                                                        class="m-0 text-danger d-none"></p>
                                                </div>
                                                <input [id]="'ssorder-' + selectedSSIndex" type="number" ngModel
                                                    name="ssorder"
                                                    class="form-control form-control-sm px-1 border-0 shadow-none"
                                                    [(ngModel)]="s.sub_sections![selectedSSIndex].order_number">
                                            </div>

                                            <div
                                                class="resp-div mt-3 mb-4 d-flex flex-column flex-md-row align-items-center justify-content-md-center">
                                                <div class="form-check form-check-inline mb-2 mb-md-0">
                                                    <input #activeSSRadioOne class="form-check-input shadow-none"
                                                        type="radio" name="ssactive" id="ssflexRadioDefault1"
                                                        [checked]="s.sub_sections![selectedSSIndex].active">
                                                    <label class="form-check-label" for="ssflexRadioDefault1">
                                                        Attiva e visibile
                                                    </label>
                                                </div>
                                                <div class="form-check form-check-inline">
                                                    <input #activeSSRadioTwo class="form-check-input shadow-none"
                                                        type="radio" name="ssactive" id="ssflexRadioDefault2"
                                                        [checked]="!s.sub_sections![selectedSSIndex].active">
                                                    <label class="form-check-label" for="ssflexRadioDefault2">
                                                        Disattiva e non visibile
                                                    </label>
                                                </div>
                                            </div>

                                            <div
                                                class="w-100 d-flex flex-column flex-md-row align-items-center justify-content-md-evenly">
                                                <app-orange-button [btnTheme]="'dark'"
                                                    [btnTitle]="'Elimina Sotto-Sezione'"
                                                    (click)="deleteSubSection(s.sub_sections[selectedSSIndex].id!)"
                                                    class="mb-3 mb-md-0"></app-orange-button>
                                                <app-orange-button [btnTheme]="'orange'"
                                                    [btnTitle]="'Aggiorna Sotto-Sezione'"
                                                    (click)="doSubSectionUpdate(s.id!, fSS)"></app-orange-button>
                                            </div>
                                            <div *ngIf="isOpSection" class="mt-3">
                                                <app-inline-loader></app-inline-loader>
                                            </div>
                                            <p [id]="'subsectionUParagMod' + selectedSSIndex + s.id"
                                                #subsectionUParagMod class="mt-3 mb-0 fs-5 fw-medium opacity-0">
                                                Sotto-Sezione aggiornata
                                                con
                                                successo!</p>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div *ngIf="isBlocksModeration" class="moderation-body d-flex flex-column align-items-center mt-2">
                <div
                    class="blocks-view w-100 d-flex flex-column flex-lg-row align-items-center justify-content-lg-evenly pb-3">
                    <button #blockViewCreate class="btn moderation-btn btn-sm px-4 rounded-1 border-0 btn-selected"
                        (click)="switchBlockView(0)">Crea nuovo blocco</button>
                    <button #blockViewAll class="btn btn-sm moderation-btn px-4 rounded-1 border-0 mt-2 mt-lg-0"
                        (click)="switchBlockView(1)">Tutti i blocchi</button>
                </div>

                <div *ngIf="isBlocksViewCreate" class="w-100 mt-3 d-flex justify-content-center">
                    <form #fNewBlock="ngForm" class="w-100 pb-2 d-flex flex-column align-items-center">
                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'btitle'">Titolo</label>
                                <p [id]="'err-ti'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'btitle'" type="text" ngModel [(ngModel)]="blockTitle" name="title"
                                class="form-control form-control-sm px-1 border-0 shadow-none" maxlength="60">
                        </div>

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'border'">Ordine visualizzazione</label>
                                <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'border'" type="number" ngModel name="order"
                                class="form-control form-control-sm px-1 border-0 shadow-none">
                        </div>

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'btype'">Tipo</label>
                                <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                            </div>
                            <select name="type" id="btype" [(ngModel)]="blockType"
                                class="form-control form-control-sm border-0 shadow-none">
                                <option value="BLOCK_ALL">Home + Forum</option>
                                <option value="BLOCK_HOME">Solo Home</option>
                                <option value="BLOCK_FORUM">Solo Forum</option>
                            </select>
                        </div>

                        <div
                            class="resp-div mt-3 d-flex flex-column flex-md-row align-items-center justify-content-md-center">
                            <div class="form-check form-check-inline mb-2 mb-md-0">
                                <input #activeRadioOne class="form-check-input shadow-none" type="radio" name="active"
                                    id="flexRadioDefault1" checked>
                                <label class="form-check-label" for="flexRadioDefault1">
                                    Attivo e visibile
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input #activeRadioTwo class="form-check-input shadow-none" type="radio" name="active"
                                    id="flexRadioDefault2">
                                <label class="form-check-label" for="flexRadioDefault2">
                                    Disattivo e non visibile
                                </label>
                            </div>
                        </div>

                        <div class="form-floating resp-div mt-3 mb-4 d-flex flex-column align-items-center">
                            <div class="d-flex w-100 justify-content-between mb-1">
                                <label [htmlFor]="'bcontent'">Contenuto</label>
                                <p [id]="'err-content'" class="m-0 text-danger d-none"></p>
                            </div>
                            <textarea [id]="'bcontent'" class="form-control shadow-none border-0"
                                placeholder="Content of the block.." [(ngModel)]="blockContent"
                                name="content"></textarea>
                        </div>

                        <div class="d-flex flex-column flex-md-row align-items-center justify-content-md-evenly w-100">
                            <app-orange-button [btnTheme]="'dark'" [btnTitle]="'Anteprima Blocco'"
                                (click)="openModal(false)" class="mb-3 mb-md-0"></app-orange-button>
                            <app-orange-button [btnTheme]="'orange'" [btnTitle]="'Crea Nuovo Blocco'"
                                (click)="doCreateNewBlock(fNewBlock)"></app-orange-button>
                        </div>
                        <div *ngIf="isOpBlock" class="mt-3">
                            <app-inline-loader></app-inline-loader>
                        </div>
                        <p #blockParagMod class="mt-3 mb-0 fs-5 fw-medium opacity-0">Blocco creato
                            con
                            successo!</p>
                    </form>
                </div>

                <div *ngIf="isBlockViewAll" class="w-100 mt-3 d-flex justify-content-center">
                    <div *ngIf="blocksArr.length" class="w-100">
                        <div *ngFor="let b of blocksArr; let i = index; let first = first" class="single-result"
                            [ngClass]="{'mt-3' : !first}">
                            <div class="su-head d-flex justify-content-between align-items-center py-2 px-3 rounded-1">
                                <div class="flex-grow-1">
                                    <p class="m-0 fw-medium fs-5 title-trunc">{{ b.title }}</p>
                                    <span [innerText]="b.e_block_type + ' | '"></span><span
                                        [innerText]="b.active ? 'Attivo' : 'Disattivo'"
                                        [ngClass]="{'text-danger' : !b.active, 'text-mod' : b.active}"></span>
                                </div>
                                <i class="bi bi-arrow-bar-down"
                                    (click)="collapseableBArr[i] = !collapseableBArr[i]"></i>
                            </div>
                            <div #collapseSections="ngbCollapse" [(ngbCollapse)]="collapseableBArr[i]"
                                class="options-container p-3 pb-4">
                                <form #fUpdateBlock="ngForm"
                                    class="w-100 mx-auto pb-2 d-flex flex-column align-items-center">
                                    <div class="mt-3 resp-div">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'btitle'">Titolo</label>
                                            <p [id]="'err-ti'" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <input [id]="'btitle'" type="text" ngModel [(ngModel)]="blocksTitleArr[i]"
                                            name="title" class="form-control form-control-sm px-1 border-0 shadow-none"
                                            maxlength="60">
                                    </div>

                                    <div class="mt-3 resp-div">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'border'">Ordine visualizzazione</label>
                                            <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <input [id]="'border'" type="number" ngModel [(ngModel)]="b.order_number"
                                            name="order" class="form-control form-control-sm px-1 border-0 shadow-none">
                                    </div>

                                    <div class="mt-3 resp-div">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'btype'">Tipo</label>
                                            <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <select name="type" id="btype" [(ngModel)]="blocksTypeArr[i]"
                                            class="form-control form-control-sm border-0 shadow-none">
                                            <option value="BLOCK_ALL">Home + Forum</option>
                                            <option value="BLOCK_HOME">Solo Home</option>
                                            <option value="BLOCK_FORUM">Solo Forum</option>
                                        </select>
                                    </div>

                                    <div
                                        class="mt-3 resp-div d-flex flex-column flex-md-row align-items-center justify-content-md-center">
                                        <div class="form-check form-check-inline mb-2 mb-md-0">
                                            <input #activeRadioOne class="form-check-input shadow-none" type="radio"
                                                name="active" (change)="activeBoolBArr[i] = !activeBoolBArr[i]"
                                                id="flexRadioDefault1" [checked]="activeBoolBArr[i]">
                                            <label class="form-check-label" for="flexRadioDefault1">
                                                Attivo e visibile
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input #activeRadioTwo class="form-check-input shadow-none" type="radio"
                                                name="active" (change)="activeBoolBArr[i] = !activeBoolBArr[i]"
                                                id="flexRadioDefault2" [checked]="!activeBoolBArr[i]">
                                            <label class="form-check-label" for="flexRadioDefault2">
                                                Disattivo e non visibile
                                            </label>
                                        </div>
                                    </div>

                                    <div class="form-floating resp-div mt-3 mb-4 d-flex flex-column align-items-center">
                                        <div class="d-flex w-100 justify-content-between mb-1">
                                            <label [htmlFor]="'bcontent'">Contenuto</label>
                                            <p [id]="'err-content'" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <textarea [id]="'bcontent'" class="form-control shadow-none border-0"
                                            placeholder="Content of the block.." [(ngModel)]="b.content"
                                            name="content"></textarea>
                                    </div>

                                    <div
                                        class="d-flex flex-column flex-md-row align-items-center justify-content-md-evenly w-100">
                                        <app-orange-button [btnTheme]="'dark'" [btnTitle]="'Anteprima Blocco'"
                                            (click)="openModal(true, i, fUpdateBlock)"
                                            class="mb-3 mb-md-0"></app-orange-button>
                                        <app-orange-button [btnTheme]="'orange'" [btnTitle]="'Aggiorna Blocco'"
                                            (click)="doUpdateBlock(fUpdateBlock, i)"></app-orange-button>
                                    </div>
                                    <div *ngIf="isOpBlock" class="mt-3">
                                        <app-inline-loader></app-inline-loader>
                                    </div>
                                    <p [id]="'blockUParagMod' + i" #blockUParagMod
                                        class="mt-3 mb-0 fs-5 fw-medium opacity-0">Blocco aggiornato
                                        con
                                        successo!</p>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>