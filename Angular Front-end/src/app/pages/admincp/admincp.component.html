<div class="h-100 pb-5">
    <app-hero></app-hero>
    <div *ngIf="!isLoadingPage && !isWaitingPage && !granted"
        class="container-fluid d-flex flex-column align-items-center mt-5">
        <h2>Non sei autorizzato..</h2>
        <h2>Ti rispedisco alla Home..</h2>
    </div>
    <div *ngIf="!isLoadingPage && !isWaitingPage && granted" class="container-fluid mt-4">
        <h1 class="mb-2 text-danger">{{ username }}</h1>
        <h3 class="mb-4">Pannello Admin</h3>

        <div class="d-flex main-container py-2">
            <div class="selection-container">
                <div class="d-flex align-items-center sect-btn rounded-1">
                    <div class="flex-grow-1 px-3 py-1">Messaggi</div>
                    <div class="px-2 icon-cont py-1"
                        (click)="isMessagesCollapsed.collapsed = !isMessagesCollapsed.collapsed">
                        <i *ngIf="isMessagesCollapsed" class="bi bi-arrow-down-short"></i>
                        <i *ngIf="!isMessagesCollapsed" class="bi bi-arrow-up-short"></i>
                    </div>
                </div>
                <div #collapse="ngbCollapse" [(ngbCollapse)]="isMessagesCollapsed.collapsed"
                    class="collapse-comp pt-1 pb-2 ps-3">
                    <div class="mb-1 selection" [ngClass]="{'txt-orange' : isMessagesCollapsed.subs['isMsgOpenView']}"
                        (click)="setNewView(isMessagesCollapsed, 'isMsgOpenView')">Messaggi aperti > {{
                        openContactMessagesArr.length }}</div>
                    <div class="selection" [ngClass]="{'txt-orange' : isMessagesCollapsed.subs['isMsgClosedView']}"
                        (click)="setNewView(isMessagesCollapsed, 'isMsgClosedView')">Messaggi archiviati > {{
                        closedContactMessagesArr.length }}</div>
                </div>

                <div class="d-flex align-items-center sect-btn rounded-1 mt-2">
                    <div class="flex-grow-1 ps-3 pe-3 py-1">Impostazioni Utenti</div>
                    <div class="px-2 icon-cont py-1" (click)="isUsersCollapsed.collapsed = !isUsersCollapsed.collapsed">
                        <i *ngIf="isUsersCollapsed" class="bi bi-arrow-down-short"></i>
                        <i *ngIf="!isUsersCollapsed" class="bi bi-arrow-up-short"></i>
                    </div>
                </div>
                <div #collapse="ngbCollapse" [(ngbCollapse)]="isUsersCollapsed.collapsed"
                    class="collapse-comp pt-1 pb-2 ps-3">
                    <div class="mb-1 selection" [ngClass]="{'txt-orange' : isUsersCollapsed.subs['isSearchUsersView']}"
                        (click)="setNewView(isUsersCollapsed, 'isSearchUsersView')">Ricerca utente</div>
                    <div class="selection" [ngClass]="{'txt-orange' : isUsersCollapsed.subs['isUsersStatsView']}"
                        (click)="setNewView(isUsersCollapsed, 'isUsersStatsView')">Statistiche</div>
                </div>

                <div class="d-flex align-items-center sect-btn rounded-1 mt-2">
                    <div class="flex-grow-1 ps-3 pe-3 py-1">Quick Ban</div>
                    <div class="px-2 icon-cont py-1"
                        (click)="isQuickBanCollapsed.collapsed = !isQuickBanCollapsed.collapsed">
                        <i *ngIf="isQuickBanCollapsed.collapsed" class="bi bi-arrow-down-short"></i>
                        <i *ngIf="!isQuickBanCollapsed.collapsed" class="bi bi-arrow-up-short"></i>
                    </div>
                </div>
                <div #collapse="ngbCollapse" [(ngbCollapse)]="isQuickBanCollapsed.collapsed"
                    class="collapse-comp pt-1 pb-2 ps-3">
                    <div class="selection" [ngClass]="{'txt-orange' : isQuickBanCollapsed.subs['isQuickBanSearchView']}"
                        (click)="setNewView(isQuickBanCollapsed, 'isQuickBanSearchView')">Ricerca utente</div>
                </div>

                <div class="d-flex align-items-center sect-btn rounded-1 mt-2">
                    <div class="flex-grow-1 ps-3 pe-3 py-1">Modera Thread</div>
                    <div class="px-2 icon-cont py-1"
                        (click)="isThreadsModCollapsed.collapsed = !isThreadsModCollapsed.collapsed">
                        <i *ngIf="isThreadsModCollapsed.collapsed" class="bi bi-arrow-down-short"></i>
                        <i *ngIf="!isThreadsModCollapsed.collapsed" class="bi bi-arrow-up-short"></i>
                    </div>
                </div>
                <div #collapse="ngbCollapse" [(ngbCollapse)]="isThreadsModCollapsed.collapsed"
                    class="collapse-comp pt-1 pb-2 ps-3">
                    <div class="selection" [ngClass]="{'txt-orange' : isThreadsModCollapsed.subs['isThreadSearchView']}"
                        (click)="setNewView(isThreadsModCollapsed, 'isThreadSearchView')">Ricerca Thread</div>
                    <div class="selection" [ngClass]="{'txt-orange' : isThreadsModCollapsed.subs['isThreadAllView']}"
                        (click)="setNewView(isThreadsModCollapsed, 'isThreadAllView')">Tutti i Thread</div>
                    <div class="selection" [ngClass]="{'txt-orange' : isThreadsModCollapsed.subs['isThreadStatsView']}"
                        (click)="setNewView(isThreadsModCollapsed, 'isThreadStatsView')">Statistiche</div>
                </div>

                <div class="d-flex align-items-center sect-btn rounded-1 mt-2">
                    <div class="flex-grow-1 ps-3 pe-3 py-1">Modera Sezioni</div>
                    <div class="px-2 icon-cont py-1"
                        (click)="isSectionsModCollapsed.collapsed = !isSectionsModCollapsed.collapsed">
                        <i *ngIf="isSectionsModCollapsed.collapsed" class="bi bi-arrow-down-short"></i>
                        <i *ngIf="!isSectionsModCollapsed.collapsed" class="bi bi-arrow-up-short"></i>
                    </div>
                </div>
                <div #collapse="ngbCollapse" [(ngbCollapse)]="isSectionsModCollapsed.collapsed"
                    class="collapse-comp pt-1 pb-2 ps-3">
                    <div class="selection"
                        [ngClass]="{'txt-orange' : isSectionsModCollapsed.subs['isSectionCreateView']}"
                        (click)="setNewView(isSectionsModCollapsed, 'isSectionCreateView')">Crea nuova Sezione</div>
                    <div class="selection"
                        [ngClass]="{'txt-orange' : isSectionsModCollapsed.subs['isSubSectionCreateView']}"
                        (click)="setNewView(isSectionsModCollapsed, 'isSubSectionCreateView')">Crea nuova Sub-Sezione
                    </div>
                    <div class="selection" [ngClass]="{'txt-orange' : isSectionsModCollapsed.subs['isSectionAllView']}"
                        (click)="setNewView(isSectionsModCollapsed, 'isSectionAllView')">Tutte le Sezioni</div>
                </div>

                <div class="d-flex align-items-center sect-btn rounded-1 mt-2">
                    <div class="flex-grow-1 ps-3 pe-3 py-1">Modera Blocchi</div>
                    <div class="px-2 icon-cont py-1"
                        (click)="isBlocksCollapsed.collapsed = !isBlocksCollapsed.collapsed">
                        <i *ngIf="isBlocksCollapsed.collapsed" class="bi bi-arrow-down-short"></i>
                        <i *ngIf="!isBlocksCollapsed.collapsed" class="bi bi-arrow-up-short"></i>
                    </div>
                </div>
                <div #collapse="ngbCollapse" [(ngbCollapse)]="isBlocksCollapsed.collapsed"
                    class="collapse-comp pt-1 pb-2 ps-3">
                    <div class="selection" [ngClass]="{'txt-orange' : isBlocksCollapsed.subs['isBlockAllView']}"
                        (click)="setNewView(isBlocksCollapsed, 'isBlockAllView')">Crea nuovo Blocco</div>
                    <div class="selection" [ngClass]="{'txt-orange' : isBlocksCollapsed.subs['isBlockCreateView']}"
                        (click)="setNewView(isBlocksCollapsed, 'isBlockCreateView')">Tutti i blocchi</div>
                </div>

                <div class="d-flex align-items-center sect-btn rounded-1 mt-2">
                    <div class="flex-grow-1 ps-3 pe-3 py-1">Informazioni</div>
                    <div class="px-2 icon-cont py-1" (click)="isInfosCollapsed.collapsed = !isInfosCollapsed.collapsed">
                        <i *ngIf="isInfosCollapsed.collapsed" class="bi bi-arrow-down-short"></i>
                        <i *ngIf="!isInfosCollapsed.collapsed" class="bi bi-arrow-up-short"></i>
                    </div>
                </div>
                <div #collapse="ngbCollapse" [(ngbCollapse)]="isInfosCollapsed.collapsed"
                    class="collapse-comp pt-1 pb-2 ps-3">
                    <div class="selection" [ngClass]="{'txt-orange' : isInfosCollapsed.subs['isInfoSysView']}"
                        (click)="setNewView(isInfosCollapsed, 'isInfoSysView')">Sistema</div>
                </div>
            </div>

            <div class="comps-container flex-grow-1 mx-3 px-3 py-1 shadow">
                <p *ngIf="isErrorMessagePanel" class="mt-4 fw-medium fs-4 text-center">{{ errorPanelMsg }}</p>
                <div *ngIf="!isErrorMessagePanel" class="h-100">
                    <app-contactmsgs *ngIf="getAnySubViewOpen(isMessagesCollapsed)" class="d-block h-100"
                        [messages]="isMessagesCollapsed.subs['isMsgOpenView'] ? openContactMessagesArr : closedContactMessagesArr"
                        [error]="contactMessagesErrorString" (onArchive)="archiveMessage($event)"
                        (onReOpen)="reOpenMessage($event)"></app-contactmsgs>
                    <app-users *ngIf="getAnySubViewOpen(isUsersCollapsed)" class="d-block h-100"
                        [isStatsView]="isUsersCollapsed.subs['isUsersStatsView']" [user_id]="user_id"></app-users>
                    <app-ban *ngIf="getAnySubViewOpen(isQuickBanCollapsed)" class="d-block h-100"
                        [user_id]="user_id"></app-ban>
                    <app-threads *ngIf="getAnySubViewOpen(isThreadsModCollapsed)" [user_id]="user_id"
                        class="d-block h-100" [isSearchThreadView]="isThreadsModCollapsed.subs['isThreadSearchView']"
                        [isAllThreadView]="isThreadsModCollapsed.subs['isThreadAllView']"
                        [isStatsThreadView]="isThreadsModCollapsed.subs['isThreadStatsView']"></app-threads>
                    <app-sections *ngIf="getAnySubViewOpen(isSectionsModCollapsed)" class="d-block h-100"
                        [isCreateSectionView]="isSectionsModCollapsed.subs['isSectionCreateView']"
                        [isCreateSubSectionView]="isSectionsModCollapsed.subs['isSubSectionCreateView']"
                        [isAllView]="isSectionsModCollapsed.subs['isSectionAllView']"
                        [user_id]="user_id"></app-sections>
                </div>
            </div>
        </div>

        <!--
            <div *ngIf="isBlocksModeration" class="moderation-body d-flex flex-column align-items-center mt-2">
                <div
                    class="blocks-view w-100 d-flex flex-column flex-lg-row align-items-center justify-content-lg-evenly pb-3">
                    <button #blockViewCreate class="btn moderation-btn btn-sm px-4 rounded-1 border-0 btn-selected"
                        (click)="switchBlockView(0)">Crea nuovo blocco</button>
                    <button #blockViewAll class="btn btn-sm moderation-btn px-4 rounded-1 border-0 mt-2 mt-lg-0"
                        (click)="switchBlockView(1)">Tutti i blocchi</button>
                </div>

                <div *ngIf="isBlocksViewCreate" class="w-100 mt-3 d-flex justify-content-center">
                    <p *ngIf="isErrorPanel" class="mt-4 fw-medium fs-5 text-center">{{ errorPanelMsg }}</p>

                    <form *ngIf="!isErrorPanel" #fNewBlock="ngForm"
                        class="w-100 pb-2 d-flex flex-column align-items-center">
                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'btitle'">Titolo</label>
                                <p [id]="'err-ti'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'btitle'" type="text" ngModel [(ngModel)]="blockTitle" name="title"
                                class="form-control form-control-sm px-1 border-0 shadow-none" maxlength="60">
                        </div>

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'border'">Ordine visualizzazione</label>
                                <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                            </div>
                            <input [id]="'border'" type="number" ngModel name="order"
                                class="form-control form-control-sm px-1 border-0 shadow-none">
                        </div>

                        <div class="resp-div mt-3">
                            <div class="d-flex justify-content-between mb-1">
                                <label [htmlFor]="'btype'">Tipo</label>
                                <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                            </div>
                            <select name="type" id="btype" [(ngModel)]="blockType"
                                class="form-control form-control-sm border-0 shadow-none">
                                <option value="BLOCK_ALL">Home + Forum</option>
                                <option value="BLOCK_HOME">Solo Home</option>
                                <option value="BLOCK_FORUM">Solo Forum</option>
                            </select>
                        </div>

                        <div
                            class="resp-div mt-3 d-flex flex-column flex-md-row align-items-center justify-content-md-center">
                            <div class="form-check form-check-inline mb-2 mb-md-0">
                                <input #activeRadioOne class="form-check-input shadow-none" type="radio" name="active"
                                    id="flexRadioDefault1" checked>
                                <label class="form-check-label" for="flexRadioDefault1">
                                    Attivo e visibile
                                </label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input #activeRadioTwo class="form-check-input shadow-none" type="radio" name="active"
                                    id="flexRadioDefault2">
                                <label class="form-check-label" for="flexRadioDefault2">
                                    Disattivo e non visibile
                                </label>
                            </div>
                        </div>

                        <div class="form-floating resp-div mt-3 mb-4 d-flex flex-column align-items-center">
                            <div class="d-flex w-100 justify-content-between mb-1">
                                <label [htmlFor]="'bcontent'">Contenuto</label>
                                <p [id]="'err-content'" class="m-0 text-danger d-none"></p>
                            </div>
                            <textarea [id]="'bcontent'" class="form-control shadow-none border-0"
                                placeholder="Content of the block.." [(ngModel)]="blockContent"
                                name="content"></textarea>
                        </div>

                        <div class="d-flex flex-column flex-md-row align-items-center justify-content-md-evenly w-100">
                            <app-orange-button [btnTheme]="'dark'" [btnTitle]="'Anteprima Blocco'"
                                (click)="openModal(false)" class="mb-3 mb-md-0"></app-orange-button>
                            <app-orange-button [btnTheme]="'orange'" [btnTitle]="'Crea Nuovo Blocco'"
                                (click)="doCreateNewBlock(fNewBlock)"></app-orange-button>
                        </div>
                        <div *ngIf="isOpBlock" class="mt-3">
                            <app-inline-loader></app-inline-loader>
                        </div>
                        <p #blockParagMod class="mt-3 mb-0 fs-5 fw-medium opacity-0">Blocco creato
                            con
                            successo!</p>
                    </form>
                </div>

                <p *ngIf="!isWaitingPanel && isErrorPanel" class="mt-4 fw-medium fs-5 text-center">{{ errorPanelMsg }}
                </p>

                <div *ngIf="!isWaitingPanel && isBlockViewAll && !isErrorPanel"
                    class="w-100 mt-3 d-flex justify-content-center">
                    <div *ngIf="blocksArr.length" class="w-100">
                        <div *ngFor="let b of blocksArr; let i = index; let first = first" class="single-result"
                            [ngClass]="{'mt-3' : !first}">
                            <div class="su-head d-flex justify-content-between align-items-center py-2 px-3 rounded-1">
                                <div class="flex-grow-1">
                                    <p class="m-0 fw-medium fs-5 trunc">{{ b.title }}</p>
                                    <span [innerText]="b.e_block_type + ' | '"></span><span
                                        [innerText]="b.active ? 'Attivo' : 'Disattivo'"
                                        [ngClass]="{'text-danger' : !b.active, 'text-mod' : b.active}"></span>
                                </div>
                                <i class="bi bi-arrow-bar-down"
                                    (click)="collapseableBArr[i] = !collapseableBArr[i]"></i>
                            </div>
                            <div #collapseSections="ngbCollapse" [(ngbCollapse)]="collapseableBArr[i]"
                                class="options-container p-3 pb-4">
                                <form #fUpdateBlock="ngForm"
                                    class="w-100 mx-auto pb-2 d-flex flex-column align-items-center">
                                    <div class="mt-3 resp-div">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'btitle'">Titolo</label>
                                            <p [id]="'err-ti'" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <input [id]="'btitle'" type="text" ngModel [(ngModel)]="blocksTitleArr[i]"
                                            name="title" class="form-control form-control-sm px-1 border-0 shadow-none"
                                            maxlength="60">
                                    </div>

                                    <div class="mt-3 resp-div">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'border'">Ordine visualizzazione</label>
                                            <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <input [id]="'border'" type="number" ngModel [(ngModel)]="b.order_number"
                                            name="order" class="form-control form-control-sm px-1 border-0 shadow-none">
                                    </div>

                                    <div class="mt-3 resp-div">
                                        <div class="d-flex justify-content-between mb-1">
                                            <label [htmlFor]="'btype'">Tipo</label>
                                            <p [id]="'err-order'" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <select name="type" id="btype" [(ngModel)]="blocksTypeArr[i]"
                                            class="form-control form-control-sm border-0 shadow-none">
                                            <option value="BLOCK_ALL">Home + Forum</option>
                                            <option value="BLOCK_HOME">Solo Home</option>
                                            <option value="BLOCK_FORUM">Solo Forum</option>
                                        </select>
                                    </div>

                                    <div
                                        class="mt-3 resp-div d-flex flex-column flex-md-row align-items-center justify-content-md-center">
                                        <div class="form-check form-check-inline mb-2 mb-md-0">
                                            <input #activeRadioOne class="form-check-input shadow-none" type="radio"
                                                name="active" (change)="activeBoolBArr[i] = !activeBoolBArr[i]"
                                                id="flexRadioDefault1" [checked]="activeBoolBArr[i]">
                                            <label class="form-check-label" for="flexRadioDefault1">
                                                Attivo e visibile
                                            </label>
                                        </div>
                                        <div class="form-check form-check-inline">
                                            <input #activeRadioTwo class="form-check-input shadow-none" type="radio"
                                                name="active" (change)="activeBoolBArr[i] = !activeBoolBArr[i]"
                                                id="flexRadioDefault2" [checked]="!activeBoolBArr[i]">
                                            <label class="form-check-label" for="flexRadioDefault2">
                                                Disattivo e non visibile
                                            </label>
                                        </div>
                                    </div>

                                    <div class="form-floating resp-div mt-3 mb-4 d-flex flex-column align-items-center">
                                        <div class="d-flex w-100 justify-content-between mb-1">
                                            <label [htmlFor]="'bcontent'">Contenuto</label>
                                            <p [id]="'err-content'" class="m-0 text-danger d-none"></p>
                                        </div>
                                        <textarea [id]="'bcontent'" class="form-control shadow-none border-0"
                                            placeholder="Content of the block.." [(ngModel)]="b.content"
                                            name="content"></textarea>
                                    </div>

                                    <div
                                        class="d-flex flex-column flex-md-row align-items-center justify-content-md-evenly w-100">
                                        <app-orange-button [btnTheme]="'dark'" [btnTitle]="'Anteprima Blocco'"
                                            (click)="openModal(true, i, fUpdateBlock)"
                                            class="mb-3 mb-md-0"></app-orange-button>
                                        <app-orange-button [btnTheme]="'orange'" [btnTitle]="'Aggiorna Blocco'"
                                            (click)="doUpdateBlock(fUpdateBlock, i)"></app-orange-button>
                                    </div>
                                    <div *ngIf="isOpBlock" class="mt-3">
                                        <app-inline-loader></app-inline-loader>
                                    </div>
                                    <p [id]="'blockUParagMod' + i" #blockUParagMod
                                        class="mt-3 mb-0 fs-5 fw-medium opacity-0">Blocco aggiornato
                                        con
                                        successo!</p>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div> -->
    </div>